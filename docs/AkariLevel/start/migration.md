# ❗ 版本迁移

> 如果您过去使用 AkariLevel 3.x 版本，并打算升级到 4.x 版本，您可以按照以下方法进行版本迁移。在安装新版本前，您应该先对整个插件文件夹进行备份。

> 您应该将 **所有旧版本的配置文件** 按照新版本的格式进行 **重写** ，而非直接替换插件本体。

---

## 变量迁移

与 3.x 版本的变量格式 `%AkariLevel_变量名称%` 不同，4.x 版本的变量格式被更改为 `%AkariLevel_等级组编辑名_变量名称%` 。

> ❗ 注意
>
> 其中，`等级组编辑名` 是一个需要您修改的内容。
>
> 4.x 版本允许您像 3.x 版本那样设置多个不同的等级组。
> 
> 为了对这些等级组进行区别，每个等级组都需要设置一个编辑名。
>
> 等级组的编辑名是 `level` 文件夹中每个 `.yml`
> 格式文件中第一级配置节点的内容，与配置文件名称无关。
>
> 如示例等级组配置中的等级组编辑名是 `Example` 。该 `Example` 并非来自配置文件名称 `Example.yml` ，而是来自:
> ``` yaml
> Example:
>   Display: "示例等级组"
>   ...
> ```

---

## 数据迁移

> 插件的数据默认保存在 database.json 文件中。

如果您使用的是 3.x 版本，那么您的数据结构可能是这样的。

``` json
{
    "PlayerName1": {
        "level": 1,
        "exp": 1
    },
    "PlayerName2": {
        "level": 2,
        "exp": 2
    }
}
```

为了升级至 4.x 版本，您可能需要调整您的数据至以下格式：

``` json
{
    "Player": {
        "PlayerName1": {
            "请替换为等级组编辑名.Level": "1",
            "请替换为等级组编辑名.Exp": "1"
        },
        "PlayerName2": {
            "请替换为等级组编辑名.Level": "2",
            "请替换为等级组编辑名.Exp": "2"
        }
    }
}
```

您需要在旧版数据文件中的玩家名称列表最前面加上 `"Player": {` ，并且在最后面加上 `}`。

修改后的数据格式看起来像这样：

``` json
{
    "Player": {
    "PlayerName1": {
        "level": 1,
        "exp": 1
    },
    "PlayerName2": {
        "level": 2,
        "exp": 2
    }
    }
}
```

然后请选中 `"Player": {` 与 `}` 中间的部分，按一下 `TAB` 键缩进。

``` json
{
    "Player": {
        "PlayerName1": {
            "level": 1,
            "exp": 1
        },
        "PlayerName2": {
            "level": 2,
            "exp": 2
        }
    }
}
```

接着在等级和经验的数值两侧加上引号。

如果需要替换的数据过多，您可以尝试借助 ChatGPT 的帮助。

``` json
{
    "Player": {
        "PlayerName1": {
            "level": "1",
            "exp": "1"
        },
        "PlayerName2": {
            "level": "2",
            "exp": "2"
        }
    }
}
```

按下 `CTRL + F` 快捷键打开查找并替换功能，将 `level` 替换为 `请替换为等级组编辑名.Level`，将 `Exp`
替换为 `请替换为等级组编辑名.Exp` 。

> ❗ 注意
>
> 其中，`请替换为等级组编辑名` 是一个需要您修改的内容。

> ❗ 注意
>
> 需要注意的是，如果您服务器的玩家名称中有 `level` 或 `exp` 字段，您应该注意这些名称是否在批量替换中被修改。

---